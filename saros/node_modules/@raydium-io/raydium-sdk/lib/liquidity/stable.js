var V=Object.create;var h=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty;var Y=(e,n)=>{for(var o in n)h(e,o,{get:n[o],enumerable:!0})},w=(e,n,o,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let u of q(n))!F.call(e,u)&&u!==o&&h(e,u,{get:()=>n[u],enumerable:!(a=K(n,u))||a.enumerable});return e};var j=(e,n,o)=>(o=e!=null?V(X(e)):{},w(n||!e||!e.__esModule?h(o,"default",{value:e,enumerable:!0}):o,e)),z=e=>w(h({},"__esModule",{value:!0}),e);var ue={};Y(ue,{DataElement:()=>C,ModelDataInfo:()=>v,ModelDataPubkey:()=>Z,formatLayout:()=>oe,getDxByDyBaseIn:()=>re,getDyByDxBaseIn:()=>ne,getStablePrice:()=>se});module.exports=z(ue);var R=require("@solana/web3.js");var G=require("@solana/web3.js"),L=j(require("bn.js"));var s=require("@solana/buffer-layout"),U=s.Layout,I=s.Structure;var M=s.seq;var N=s.blob;var T=class extends U{constructor(o,a,u){super(o,u);this.blob=N(o),this.signed=a}decode(o,a=0){let u=new L.default(this.blob.decode(o,a),10,"le");return this.signed?u.fromTwos(this.span*8).clone():u}encode(o,a,u=0){return typeof o=="number"&&(o=new L.default(o)),this.signed&&(o=o.toTwos(this.span*8)),this.blob.encode(o.toArrayLike(Buffer,"le",this.span),a,u)}};function b(e){return new T(8,!1,e)}var B=class extends I{decode(n,o){return super.decode(n,o)}};function S(e,n,o){return new B(e,n,o)}function k(e,n,o){let a,u=typeof n=="number"?n:(0,L.isBN)(n)?n.toNumber():new Proxy(n,{get(i,t){if(!a){let r=Reflect.get(i,"count");a=(0,L.isBN)(r)?r.toNumber():r,Reflect.set(i,"count",a)}return Reflect.get(i,t)},set(i,t,r){return t==="count"&&(a=r),Reflect.set(i,t,r)}});return M(e,u,o)}var Z=new R.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),g=5e4,C=S([b("x"),b("y"),b("price")]),v=S([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),k(C,g,"DataElement")]);function H(e,n){return[0,g-2]}function J(e){return[0,g-2]}function O(e){return[0,g-2]}function Q(e,n,o){let[a,u]=H(n,o),i=a,t=u,r=0,c=n*e.multiplier/o;for(;i<=t;){if(r=Math.floor((t+i)/2),r===0||r>=g-2)return[r,r,!1];let y=e.DataElement[r].x*e.multiplier/e.DataElement[r].y,p=e.DataElement[r-1].x*e.multiplier/e.DataElement[r-1].y,m=e.DataElement[r+1].x*e.multiplier/e.DataElement[r+1].y;if(c===y)return[r,r,!0];if(c===p)return[r-1,r-1,!0];if(c===m)return[r+1,r+1,!0];if(c<p)t=r-1;else{if(c>p&&c<y)return[r-1,r,!0];if(c>y&&c<m)return[r,r+1,!0];i=r+1}}return[r,r,!1]}function _(e,n,o){let[a,u,i]=Q(e,n,o);if(!i)return 0;if(a===u){let t=e.DataElement[a].x;return n*e.multiplier/t}else{let t=e.DataElement[a].x,r=e.DataElement[a].y,c=e.DataElement[u].x,y=e.DataElement[u].y,p=o*(c*r-t*y),m=t*p,d=(c-t)*(n*r-t*o)*y,l=m+d;return n*e.multiplier*p/l}}function P(e,n,o){return n*e.multiplier/o}function D(e,n,o){return n*o/e.multiplier}function W(e,n){let[o,a]=J(n),u=o,i=a,t=0,r=n;for(;u<i;){if(t=Math.floor((i+u)/2),t<=0||t>g-2)return[t,t,!1];let c=e.DataElement[t].x,y=e.DataElement[t-1].x,p=e.DataElement[t+1].x;if(r===c)return[t,t,!0];if(r===y)return[t-1,t-1,!0];if(r===p)return[t+1,t+1,!0];if(r<y)i=t-1;else{if(r>y&&r<c)return[t-1,t,!0];if(r>c&&r<p)return[t,t+1,!0];u=t+1}}return[t,t,!1]}function $(e,n){let[o,a]=O(n),u=o,i=a,t=0,r=n;for(;u<=i;){if(t=Math.floor((i+u)/2),t<=0||t>=g-2)return[t,t,!1];let c=e.DataElement[t].y,y=e.DataElement[t-1].y,p=e.DataElement[t+1].y;if(r===c)return[t,t,!0];if(r===y)return[t-1,t-1,!0];if(r===p)return[t+1,t+1,!0];if(r<p)u=t+1;else{if(r<y&&r>c)return[t-1,t,!0];if(r<c&&r>p)return[t,t+1,!0];i=t-1}}return[t,t,!1]}function A(e,n,o,a){let u=a?n+o:n-o,[i,t,r]=W(e,u);if(!r)return[0,0,!1,r];if(i===t)return[e.DataElement[t].price,e.DataElement[t].y,!1,r];{let c=e.DataElement[i].x,y=e.DataElement[t].x,p=e.DataElement[i].price,m=e.DataElement[t].price,d=e.DataElement[i].y,l=e.DataElement[t].y;if(n>=c&&n<=y)return a?[m,l,!0,r]:[p,d,!0,r];{let f,x;return a?(f=p+(m-p)*(n-c)/(y-c),x=d-(u-c)*e.multiplier/m):(f=p+(m-p)*(n-c)/(y-c),x=l+(y-u)*e.multiplier/p),[f,x,!1,r]}}}function ee(e,n,o,a){let u=a?n-o:n+o,[i,t,r]=$(e,u);if(!r)return[0,0,!1,r];if(i===t)return[e.DataElement[t].price,e.DataElement[t].x,!1,r];{let c=e.DataElement[i].x,y=e.DataElement[t].x,p=e.DataElement[i].price,m=e.DataElement[t].price,d=e.DataElement[i].y,l=e.DataElement[t].y;if(n>=l&&n<=d)return a?[m,y,!0,r]:[p,c,!0,r];{let f,x;return a?(f=p+(m-p)*(d-n)/(d-l),x=c+m*(d-u)/e.multiplier):(f=p+(m-p)*(d-n)/(d-l),x=y-p*(u-l)/e.multiplier),[f,x,!1,r]}}}function te(e,n){let o=A(e,n,0,!1);return o[3]?o[0]:0}function ne(e,n,o,a){let u=_(e,n,o),i=P(e,n,u),t=P(e,o,u),r=P(e,a,u),c=!0,[y,p,m,d]=A(e,i,r,c);if(!d)return 0;if(m)return a*e.multiplier/y;{let l=t-p;return D(e,l,u)}}function re(e,n,o,a){let u=_(e,n,o),i=P(e,n,u),t=P(e,o,u),r=P(e,a,u),c=!1,[y,p,m,d]=ee(e,t,r,c);if(!d)return 0;if(m)return a*y/e.multiplier;{let l=i-p;return D(e,l,u)}}function oe(e){let n=v.decode(e);return{accountType:n.accountType.toNumber(),status:n.status.toNumber(),multiplier:n.multiplier.toNumber(),validDataCount:n.validDataCount.toNumber(),DataElement:n.DataElement.map(o=>({x:o.x.toNumber(),y:o.y.toNumber(),price:o.price.toNumber()}))}}function se(e,n,o,a){let u=te(e,P(e,n,_(e,n,o)))/e.multiplier;return a?u:1/u}0&&(module.exports={DataElement,ModelDataInfo,ModelDataPubkey,formatLayout,getDxByDyBaseIn,getDyByDxBaseIn,getStablePrice});
//# sourceMappingURL=stable.js.map