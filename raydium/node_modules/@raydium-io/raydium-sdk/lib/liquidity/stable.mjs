import{PublicKey as V}from"@solana/web3.js";import{PublicKey as Oe}from"@solana/web3.js";import I,{isBN as M}from"bn.js";import{bits as Q,BitStructure as W,blob as C,Blob as $,cstr as ee,f32 as te,f32be as ne,f64 as re,f64be as oe,greedy as se,Layout as v,ns64 as ue,ns64be as ae,nu64 as ie,nu64be as ce,offset as pe,s16 as ye,s16be as me,s24 as de,s24be as le,s32 as fe,s32be as be,s40 as xe,s40be as Pe,s48 as ge,s48be as Le,s8 as he,seq as D,struct as Te,Structure as A,u16 as Be,u16be as Se,u24 as _e,u24be as we,u32 as Ee,u32be as Ue,u40 as Ie,u40be as Me,u48 as Ne,u48be as ke,u8 as Re,UInt as Ce,union as ve,Union as De,unionLayoutDiscriminator as Ae,utf8 as Ve}from"@solana/buffer-layout";var _=v,w=A;var E=D;var U=C;var g=class extends _{constructor(o,u,s){super(o,s);this.blob=U(o),this.signed=u}decode(o,u=0){let s=new I(this.blob.decode(o,u),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(o,u,s=0){return typeof o=="number"&&(o=new I(o)),this.signed&&(o=o.toTwos(this.span*8)),this.blob.encode(o.toArrayLike(Buffer,"le",this.span),u,s)}};function f(e){return new g(8,!1,e)}var L=class extends w{decode(r,o){return super.decode(r,o)}};function h(e,r,o){return new L(e,r,o)}function N(e,r,o){let u,s=typeof r=="number"?r:M(r)?r.toNumber():new Proxy(r,{get(a,t){if(!u){let n=Reflect.get(a,"count");u=M(n)?n.toNumber():n,Reflect.set(a,"count",u)}return Reflect.get(a,t)},set(a,t,n){return t==="count"&&(u=n),Reflect.set(a,t,n)}});return E(e,s,o)}var rt=new V("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),P=5e4,K=h([f("x"),f("y"),f("price")]),q=h([f("accountType"),f("status"),f("multiplier"),f("validDataCount"),N(K,P,"DataElement")]);function X(e,r){return[0,P-2]}function F(e){return[0,P-2]}function Y(e){return[0,P-2]}function j(e,r,o){let[u,s]=X(r,o),a=u,t=s,n=0,i=r*e.multiplier/o;for(;a<=t;){if(n=Math.floor((t+a)/2),n===0||n>=P-2)return[n,n,!1];let p=e.DataElement[n].x*e.multiplier/e.DataElement[n].y,c=e.DataElement[n-1].x*e.multiplier/e.DataElement[n-1].y,y=e.DataElement[n+1].x*e.multiplier/e.DataElement[n+1].y;if(i===p)return[n,n,!0];if(i===c)return[n-1,n-1,!0];if(i===y)return[n+1,n+1,!0];if(i<c)t=n-1;else{if(i>c&&i<p)return[n-1,n,!0];if(i>p&&i<y)return[n,n+1,!0];a=n+1}}return[n,n,!1]}function T(e,r,o){let[u,s,a]=j(e,r,o);if(!a)return 0;if(u===s){let t=e.DataElement[u].x;return r*e.multiplier/t}else{let t=e.DataElement[u].x,n=e.DataElement[u].y,i=e.DataElement[s].x,p=e.DataElement[s].y,c=o*(i*n-t*p),y=t*c,m=(i-t)*(r*n-t*o)*p,d=y+m;return r*e.multiplier*c/d}}function x(e,r,o){return r*e.multiplier/o}function k(e,r,o){return r*o/e.multiplier}function z(e,r){let[o,u]=F(r),s=o,a=u,t=0,n=r;for(;s<a;){if(t=Math.floor((a+s)/2),t<=0||t>P-2)return[t,t,!1];let i=e.DataElement[t].x,p=e.DataElement[t-1].x,c=e.DataElement[t+1].x;if(n===i)return[t,t,!0];if(n===p)return[t-1,t-1,!0];if(n===c)return[t+1,t+1,!0];if(n<p)a=t-1;else{if(n>p&&n<i)return[t-1,t,!0];if(n>i&&n<c)return[t,t+1,!0];s=t+1}}return[t,t,!1]}function G(e,r){let[o,u]=Y(r),s=o,a=u,t=0,n=r;for(;s<=a;){if(t=Math.floor((a+s)/2),t<=0||t>=P-2)return[t,t,!1];let i=e.DataElement[t].y,p=e.DataElement[t-1].y,c=e.DataElement[t+1].y;if(n===i)return[t,t,!0];if(n===p)return[t-1,t-1,!0];if(n===c)return[t+1,t+1,!0];if(n<c)s=t+1;else{if(n<p&&n>i)return[t-1,t,!0];if(n<i&&n>c)return[t,t+1,!0];a=t-1}}return[t,t,!1]}function R(e,r,o,u){let s=u?r+o:r-o,[a,t,n]=z(e,s);if(!n)return[0,0,!1,n];if(a===t)return[e.DataElement[t].price,e.DataElement[t].y,!1,n];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(r>=i&&r<=p)return u?[y,d,!0,n]:[c,m,!0,n];{let l,b;return u?(l=c+(y-c)*(r-i)/(p-i),b=m-(s-i)*e.multiplier/y):(l=c+(y-c)*(r-i)/(p-i),b=d+(p-s)*e.multiplier/c),[l,b,!1,n]}}}function Z(e,r,o,u){let s=u?r-o:r+o,[a,t,n]=G(e,s);if(!n)return[0,0,!1,n];if(a===t)return[e.DataElement[t].price,e.DataElement[t].x,!1,n];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(r>=d&&r<=m)return u?[y,p,!0,n]:[c,i,!0,n];{let l,b;return u?(l=c+(y-c)*(m-r)/(m-d),b=i+y*(m-s)/e.multiplier):(l=c+(y-c)*(m-r)/(m-d),b=p-c*(s-d)/e.multiplier),[l,b,!1,n]}}}function H(e,r){let o=R(e,r,0,!1);return o[3]?o[0]:0}function ot(e,r,o,u){let s=T(e,r,o),a=x(e,r,s),t=x(e,o,s),n=x(e,u,s),i=!0,[p,c,y,m]=R(e,a,n,i);if(!m)return 0;if(y)return u*e.multiplier/p;{let d=t-c;return k(e,d,s)}}function st(e,r,o,u){let s=T(e,r,o),a=x(e,r,s),t=x(e,o,s),n=x(e,u,s),i=!1,[p,c,y,m]=Z(e,t,n,i);if(!m)return 0;if(y)return u*p/e.multiplier;{let d=a-c;return k(e,d,s)}}function ut(e){let r=q.decode(e);return{accountType:r.accountType.toNumber(),status:r.status.toNumber(),multiplier:r.multiplier.toNumber(),validDataCount:r.validDataCount.toNumber(),DataElement:r.DataElement.map(o=>({x:o.x.toNumber(),y:o.y.toNumber(),price:o.price.toNumber()}))}}function at(e,r,o,u){let s=H(e,x(e,r,T(e,r,o)))/e.multiplier;return u?s:1/s}export{K as DataElement,q as ModelDataInfo,rt as ModelDataPubkey,ut as formatLayout,st as getDxByDyBaseIn,ot as getDyByDxBaseIn,at as getStablePrice};
//# sourceMappingURL=stable.mjs.map