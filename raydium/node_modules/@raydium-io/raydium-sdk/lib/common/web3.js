var p=Object.defineProperty,W=Object.defineProperties,j=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var O=(e,r,t)=>r in e?p(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,A=(e,r)=>{for(var t in r||(r={}))b.call(r,t)&&O(e,t,r[t]);if(w)for(var t of w(r))$.call(r,t)&&O(e,t,r[t]);return e},d=(e,r)=>W(e,z(r));var V=(e,r)=>{for(var t in r)p(e,t,{get:r[t],enumerable:!0})},q=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of J(r))!b.call(e,o)&&o!==t&&p(e,o,{get:()=>r[o],enumerable:!(n=j(r,o))||n.enumerable});return e};var X=e=>q(p({},"__esModule",{value:!0}),e);var tr={};V(tr,{forecastTransactionSize:()=>L,getMultipleAccountsInfo:()=>v,getMultipleAccountsInfoWithCustomFlags:()=>Z,parseSimulateLogToJson:()=>Y,parseSimulateValue:()=>rr,simulateMultipleInstruction:()=>Q});module.exports=X(tr);var g=require("@solana/web3.js");function U(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var x=require("@solana/web3.js");var I="1.1.0-beta.5";var ir=require("@colors/colors"),S=!1,P=!1,N={debug:1,default:2,info:2,warning:3,error:4,off:5},_={},T;function H(){try{let e=[];if(["NFD","NFC","NFKD","NFKC"].forEach(r=>{try{if("test".normalize(r)!=="test")throw new Error("bad normalize")}catch{e.push(r)}}),e.length)throw new Error("missing "+e.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(e){if(e instanceof Error)return e.message}return""}var M=H(),C=(s=>(s.DEBUG="DEBUG",s.INFO="INFO",s.WARNING="WARNING",s.ERROR="ERROR",s.OFF="OFF",s))(C||{}),G=(l=>(l.UNKNOWN_ERROR="UNKNOWN_ERROR",l.NOT_IMPLEMENTED="NOT_IMPLEMENTED",l.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",l.NETWORK_ERROR="NETWORK_ERROR",l.RPC_ERROR="RPC_ERROR",l.TIMEOUT="TIMEOUT",l.BUFFER_OVERRUN="BUFFER_OVERRUN",l.NUMERIC_FAULT="NUMERIC_FAULT",l.MISSING_NEW="MISSING_NEW",l.INVALID_ARGUMENT="INVALID_ARGUMENT",l.MISSING_ARGUMENT="MISSING_ARGUMENT",l.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",l.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",l))(G||{}),F="0123456789abcdef";function D(e,r=!1){let t=e;try{if(e instanceof Uint8Array){let n="";for(let o=0;o<e.length;o++)n+=F[e[o]>>4],n+=F[e[o]&15];t=`Uint8Array(0x${n})`}else if(e instanceof x.PublicKey)t=`PublicKey(${e.toBase58()})`;else if(e instanceof Object&&!r){let n={};Object.entries(e).forEach(([o,s])=>{n[o]=D(s,!0)}),t=JSON.stringify(n)}else r||(t=JSON.stringify(e))}catch{t=JSON.stringify(e.toString())}return t}var i=class{constructor(r){this.version=I;this.moduleName=r}_log(r,t){let n=r.toLowerCase();N[n]==null&&this.throwArgumentError("invalid log level name","logLevel",r),!((_[this.moduleName]||N.default)>N[n])&&console.log(...t)}debug(...r){this._log(i.levels.DEBUG,["[DEBUG]".blue,...r])}info(...r){this._log(i.levels.INFO,["[INFO]".green,...r])}warn(...r){this._log(i.levels.WARNING,["[WARN]".yellow,...r])}makeError(r,t,n){if(P)return this.makeError("censored error",t,{});t||(t=i.errors.UNKNOWN_ERROR),n||(n={});let o=[];Object.entries(n).forEach(([c,a])=>{o.push(`${c}=${D(a)})`)}),o.push(`code=${t}`),o.push(`module=${this.moduleName}`),o.push(`version=${this.version}`);let s=r;o.length&&(r+=" ("+o.join(", ")+")");let u=new Error(r);return u.reason=s,u.code=t,Object.entries(n).forEach(([c,a])=>{u[c]=a}),u}throwError(r,t,n){throw this.makeError(r,t,n)}throwArgumentError(r,t,n){return this.throwError(r,i.errors.INVALID_ARGUMENT,{argument:t,value:n})}assert(r,t,n,o){r||this.throwError(t,n,o)}assertArgument(r,t,n,o){r||this.throwArgumentError(t,n,o)}checkNormalize(r){r==null&&(r="platform missing String.prototype.normalize"),M&&this.throwError("platform missing String.prototype.normalize",i.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:M})}checkSafeUint53(r,t){typeof r=="number"&&(t==null&&(t="value not safe"),(r<0||r>=9007199254740991)&&this.throwError(t,i.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:r}),r%1&&this.throwError(t,i.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:r}))}checkArgumentCount(r,t,n){n?n=": "+n:n="",r<t&&this.throwError("missing argument"+n,i.errors.MISSING_ARGUMENT,{count:r,expectedCount:t}),r>t&&this.throwError("too many arguments"+n,i.errors.UNEXPECTED_ARGUMENT,{count:r,expectedCount:t})}checkNew(r,t){(r===Object||r==null)&&this.throwError("missing new",i.errors.MISSING_NEW,{name:t.name})}checkAbstract(r,t){r===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",i.errors.UNSUPPORTED_OPERATION,{name:r.name,operation:"new"}):(r===Object||r==null)&&this.throwError("missing new",i.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return T||(T=new i(I)),T}static setCensorship(r,t){if(!r&&t&&this.globalLogger().throwError("cannot permanently disable censorship",i.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),S){if(!r)return;this.globalLogger().throwError("error censorship permanent",i.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}P=!!r,S=!!t}static setLogLevel(r,t){let n=N[t.toLowerCase()];if(n==null){i.globalLogger().warn("invalid log level - "+t);return}_[r]=n}static from(r){return new i(r)}},m=i;m.errors=G,m.levels=C;var f=m.from("common/web3");async function v(e,r,t){let{batchRequest:n,commitment:o}=A({batchRequest:!1},t),s=U(r,100),u=new Array(s.length).fill([]);if(n){let c=s.map(h=>{let R=e._buildArgs([h.map(E=>E.toBase58())],o,"base64");return{methodName:"getMultipleAccounts",args:R}});u=(await e._rpcBatchRequest(c)).map(h=>h.error?f.throwError("failed to get info for multiple accounts",m.errors.RPC_ERROR,{message:h.error.message}):h.result.value.map(R=>{if(R){let{data:E,executable:k,lamports:l,owner:B,rentEpoch:K}=R;return E.length!==2&&E[1]!=="base64"?f.throwError("info must be base64 encoded",m.errors.RPC_ERROR):{data:Buffer.from(E[0],"base64"),executable:k,lamports:l,owner:new g.PublicKey(B),rentEpoch:K}}else return null}))}else try{u=await Promise.all(s.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){if(c instanceof Error)return f.throwError("failed to get info for multiple accounts",m.errors.RPC_ERROR,{message:c.message})}return u.flat()}async function Z(e,r,t){let n=await v(e,r.map(o=>o.pubkey),t);return r.map((o,s)=>d(A({},o),{accountInfo:n[s]}))}function L(e,r){if(e.length<1)return f.throwArgumentError("no instructions provided","instructions",e);if(r.length<1)return f.throwArgumentError("no signers provided","signers",r);let t=new g.Transaction({recentBlockhash:"11111111111111111111111111111111",feePayer:r[0]});t.add(...e);let n=t.compileMessage().serialize();return r.length+r.length*64+n.length}async function Q(e,r,t){let n=new g.PublicKey("RaydiumSimuLateTransaction11111111111111111"),o=[],s=new g.Transaction({feePayer:n});for(let a of r)L([...s.instructions,a],[n])>g.PACKET_DATA_SIZE&&(o.push(s),s=new g.Transaction({feePayer:n})),s.add(a);s.instructions.length>0&&o.push(s);let u=[];try{u=await Promise.all(o.map(a=>e.simulateTransaction(a)))}catch(a){if(a instanceof Error)return f.throwError("failed to simulate for instructions",m.errors.RPC_ERROR,{message:a.message})}let c=[];for(let a of u){let{value:h}=a;if(f.debug("simulate result:",a),h.logs){let R=h.logs.filter(E=>E&&E.includes(t));f.debug("filteredLog:",c),f.assertArgument(R.length!==0,"simulate log not match keyword","keyword",t),c.push(...R)}}return c}function Y(e,r){let t=e.match(/{["\w:,]+}/g);return!t||t.length!==1?f.throwArgumentError("simulate log fail to match json","keyword",r):t[0]}function rr(e,r){let n=new RegExp(`"${r}":(\\d+)`,"g").exec(e);return!n||n.length!==2?f.throwArgumentError("simulate log fail to match key","key",r):n[1]}0&&(module.exports={forecastTransactionSize,getMultipleAccountsInfo,getMultipleAccountsInfoWithCustomFlags,parseSimulateLogToJson,parseSimulateValue,simulateMultipleInstruction});
//# sourceMappingURL=web3.js.map